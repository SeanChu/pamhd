TESTS_MHD_EXECUTABLES = \
  tests/mhd/reference.exe \
  tests/mhd/mhd2gnuplot.exe \
  tests/mhd/test.exe

TESTS_MHD_TESTS = \
  tests/mhd/reference.tst

tests/mhd_executables: $(TESTS_MHD_EXECUTABLES)

tests/mhd_tests: $(TESTS_MHD_TESTS)

tests/mhd_clean_results:
	@echo "CLEAN RESULTS tests/mhd" && rm -f \
	  tests/mhd/*.dat \
	  tests/mhd/*.png \
	  tests/mhd/results/*/*.dat \
	  tests/mhd/results/*/*.png \
	  tests/mhd/results/*/*.dc

tests/mhd_clean:
	@echo "CLEAN tests/mhd" && rm -f \
	  $(TESTS_MHD_EXECUTABLES) \
	  $(TESTS_MHD_TESTS)

EXECUTABLES += tests/mhd_executables
TESTS += tests/mhd_tests
RESULTS += tests/mhd_clean_results
CLEAN += tests/mhd_clean

MHD_COMMON_HEADERS = \
  source/boundaries/common.hpp \
  source/boundaries/initial_condition.hpp \
  source/boundaries/copy_boundary.hpp \
  source/boundaries/value_boundaries.hpp \
  source/mhd/common.hpp \
  source/mhd/initialize.hpp \
  source/mhd/save.hpp \
  source/mhd/solve.hpp \
  source/mhd/variables.hpp \
  source/mhd/hll_athena.hpp \
  source/mhd/hlld_athena.hpp

tests/mhd/reference.exe: tests/mhd/reference.cpp $(MHD_COMMON_HEADERS)
	@echo "CXX "$< && $(CXX) \
	  $(CPPFLAGS) \
	  $(CXXFLAGS) \
	  $(LDFLAGS) \
	  $(EIGEN_CPPFLAGS) \
	  $(GENSIMCELL_CPPFLAGS) \
	  $(BOOST_CPPFLAGS) \
	  $(BOOST_LDFLAGS) \
	  $(BOOST_LIBS) \
	  $< -o $@

tests/mhd/mhd2gnuplot.exe: tests/mhd/mhd2gnuplot.cpp source/mhd/variables.hpp
	@echo "MPICXX "$< && $(MPICXX) \
	  $(CPPFLAGS) \
	  $(CXXFLAGS) \
	  $(LDFLAGS) \
	  $(DCCRG_CPPFLAGS) \
	  $(EIGEN_CPPFLAGS) \
	  $(GENSIMCELL_CPPFLAGS) \
	  $< -o $@

tests/mhd/test.exe: tests/mhd/test.cpp $(MHD_COMMON_HEADERS)
	@echo "MPICXX "$< && $(MPICXX) \
	  $(CPPFLAGS) \
	  $(CXXFLAGS) \
	  $(LDFLAGS) \
	  $(DCCRG_CPPFLAGS) \
	  $(DCCRG_LDFLAGS) \
	  $(DCCRG_LIBS) \
	  $(EIGEN_CPPFLAGS) \
	  $(GENSIMCELL_CPPFLAGS) \
	  $(BOOST_CPPFLAGS) \
	  $(BOOST_LDFLAGS) \
	  $(BOOST_LIBS) \
	  $(MUPARSERX_CPPFLAGS) \
	  $(MUPARSERX_LDFLAGS) \
	  $(MUPARSERX_LIBS) \
	  $(PRETTYPRINT_CPPFLAGS) \
	  $(ZOLTAN_CPPFLAGS) \
	  $(ZOLTAN_LDFLAGS) \
	  $(ZOLTAN_LIBS) \
	  $< -o $@
